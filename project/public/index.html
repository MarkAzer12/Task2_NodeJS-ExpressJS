<!DOCTYPE html>
<html>
<head>
  <title>Students</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">

<h2 class="mb-3">Student System</h2>

<form id="studentForm" class="row g-2 mb-4">
  <input type="hidden" id="id">
  <div class="col-md-3">
    <input class="form-control" id="name" placeholder="Name">
  </div>
  <div class="col-md-2">
    <input class="form-control" id="age" placeholder="Age">
  </div>
  <div class="col-md-4">
    <input class="form-control" id="email" placeholder="Email">
  </div>
  <div class="col-md-3">
    <button class="btn btn-primary w-100">Save</button>
  </div>
</form>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>Name</th><th>Age</th><th>Email</th><th>Actions</th>
    </tr>
  </thead>
  <tbody id="students"></tbody>
</table>

<script>
const api = "/api/students";
const tbody = document.getElementById("students");

function loadStudents() {
  fetch(api)
    .then(res => res.json())
    .then(data => {
      tbody.innerHTML = "";
      data.forEach(s => {
        tbody.innerHTML += `
          <tr>
            <td>${s.name}</td>
            <td>${s.age}</td>
            <td>${s.email}</td>
            <td>
              <button class="btn btn-warning btn-sm" onclick="editStudent('${s._id}')">Edit</button>
              <button class="btn btn-danger btn-sm" onclick="deleteStudent('${s._id}')">Delete</button>
            </td>
          </tr>
        `;
      });
    });
}

document.getElementById("studentForm").onsubmit = e => {
  e.preventDefault();
  const id = document.getElementById("id").value;

  const student = {
    name: name.value,
    age: age.value,
    email: email.value
  };

  fetch(id ? api + "/" + id : api, {
    method: id ? "PUT" : "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(student)
  }).then(() => {
    e.target.reset();
    document.getElementById("id").value = "";
    loadStudents();
  });
};

function editStudent(id) {
  fetch(api + "/" + id)
    .then(res => res.json())
    .then(s => {
      document.getElementById("id").value = s._id;
      name.value = s.name;
      age.value = s.age;
      email.value = s.email;
    });
}

function deleteStudent(id) {
  fetch(api + "/" + id, { method: "DELETE" })
    .then(loadStudents);
}

loadStudents();
</script>

</body>
</html>